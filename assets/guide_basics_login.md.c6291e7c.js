import{_ as s,o as n,c as a,a as l}from"./app.bac17831.js";const C=JSON.parse('{"title":"\u767B\u5F55 & \u767B\u51FA","description":"","frontmatter":{},"headers":[{"level":2,"title":"1. \u57FA\u672C\u7684\u767B\u5F55\u903B\u8F91","slug":"_1-\u57FA\u672C\u7684\u767B\u5F55\u903B\u8F91"},{"level":2,"title":"2. \u767B\u5F55","slug":"_2-\u767B\u5F55"},{"level":3,"title":"2.1 \u53EA\u7ED9\u5B9AuserId","slug":"_2-1-\u53EA\u7ED9\u5B9Auserid"},{"level":3,"title":"2.2 \u7ED1\u5B9A\uFF08\u64CD\u4F5C\u7CFB\u7EDF\u3001\u5E73\u53F0\uFF09\u7B49","slug":"_2-2-\u7ED1\u5B9A\u8BBE\u5907\u7C7B\u578B\uFF08\u64CD\u4F5C\u7CFB\u7EDF\u3001\u5E73\u53F0\uFF09\u7B49"},{"level":3,"title":"2.3 \u7ED1\u5B9A","slug":"_2-3-\u7ED1\u5B9A\u8BBE\u5907\u7C7B\u578B\u3001\u8BBE\u5907id"},{"level":2,"title":"3. \u767B\u51FA\uFF08\u9000\u51FA\u767B\u5F55\uFF09","slug":"_3-\u767B\u51FA\uFF08\u9000\u51FA\u767B\u5F55\uFF09"},{"level":3,"title":"3.1 \u9000\u51FA","slug":"_3-1-\u9000\u51FA\u5F53\u524D\u8BF7\u6C42\u7528\u6237"},{"level":3,"title":"3.2 \u9000\u51FA","slug":"_3-2-\u9000\u51FA\u5F53\u524D\u8BF7\u6C42\u7528\u6237\u7684\u4EFB\u610F\u7C7B\u578B\u7684\u8BBE\u5907"},{"level":3,"title":"3.3 \u9000\u51FA","slug":"_3-3-\u9000\u51FA\u5F53\u524D\u8BF7\u6C42\u7528\u6237\u7684\u4EFB\u610F\u8BBE\u5907\u7C7B\u578B-\u4EFB\u610F\u8BBE\u5907id\u7684\u8BBE\u5907"},{"level":3,"title":"3.4 \u9000\u51FA","slug":"_3-4-\u9000\u51FA\u5F53\u524D\u8BF7\u6C42\u7528\u6237\u7684\u6240\u6709\u8BBE\u5907"},{"level":2,"title":"4. \u7EDF\u4E00\u7684\u767B\u5F55\u5F02\u5E38\u5904\u7406","slug":"_4-\u7EDF\u4E00\u7684\u767B\u5F55\u5F02\u5E38\u5904\u7406"},{"level":2,"title":"5. \u767B\u5F55\u8BF7\u6C42\u4EE5\u53CAtoken\u914D\u7F6E\uFF08\u5982\u4F55\u4F7F\u7528\u8FD4\u56DE\u7684token\uFF0Ctoken\u7684\u8FC7\u671F\u65F6\u95F4\uFF09","slug":"_5-\u767B\u5F55\u8BF7\u6C42\u4EE5\u53CAtoken\u914D\u7F6E\uFF08\u5982\u4F55\u4F7F\u7528\u8FD4\u56DE\u7684token\uFF0Ctoken\u7684\u8FC7\u671F\u65F6\u95F4\uFF09"},{"level":3,"title":"5.1 \u53CCToken\u6A21\u5F0F","slug":"_5-1-\u53CCtoken\u6A21\u5F0F"},{"level":3,"title":"5.2 \u5355Token\u6A21\u5F0F","slug":"_5-2-\u5355token\u6A21\u5F0F"},{"level":3,"title":"5.3 cookie\u643A\u5E26token","slug":"_5-3-cookie\u643A\u5E26token"}],"relativePath":"guide/basics/login.md","lastUpdated":1661873328000}'),p={name:"guide/basics/login.md"},o=l(`<h1 id="\u767B\u5F55-\u767B\u51FA" tabindex="-1">\u767B\u5F55 &amp; \u767B\u51FA <a class="header-anchor" href="#\u767B\u5F55-\u767B\u51FA" aria-hidden="true">#</a></h1><nav class="table-of-contents"><ul><li><a href="#_1-\u57FA\u672C\u7684\u767B\u5F55\u903B\u8F91">1. \u57FA\u672C\u7684\u767B\u5F55\u903B\u8F91</a></li><li><a href="#_2-\u767B\u5F55">2. \u767B\u5F55</a><ul><li><a href="#_2-1-\u53EA\u7ED9\u5B9Auserid">2.1 \u53EA\u7ED9\u5B9AuserId</a></li><li><a href="#_2-2-\u7ED1\u5B9A\u8BBE\u5907\u7C7B\u578B\uFF08\u64CD\u4F5C\u7CFB\u7EDF\u3001\u5E73\u53F0\uFF09\u7B49">2.2 \u7ED1\u5B9A\u8BBE\u5907\u7C7B\u578B\uFF08\u64CD\u4F5C\u7CFB\u7EDF\u3001\u5E73\u53F0\uFF09\u7B49</a></li><li><a href="#_2-3-\u7ED1\u5B9A\u8BBE\u5907\u7C7B\u578B\u3001\u8BBE\u5907id">2.3 \u7ED1\u5B9A\u8BBE\u5907\u7C7B\u578B\u3001\u8BBE\u5907Id</a></li></ul></li><li><a href="#_3-\u767B\u51FA\uFF08\u9000\u51FA\u767B\u5F55\uFF09">3. \u767B\u51FA\uFF08\u9000\u51FA\u767B\u5F55\uFF09</a><ul><li><a href="#_3-1-\u9000\u51FA\u5F53\u524D\u8BF7\u6C42\u7528\u6237">3.1 \u9000\u51FA\u5F53\u524D\u8BF7\u6C42\u7528\u6237</a></li><li><a href="#_3-2-\u9000\u51FA\u5F53\u524D\u8BF7\u6C42\u7528\u6237\u7684\u4EFB\u610F\u7C7B\u578B\u7684\u8BBE\u5907">3.2 \u9000\u51FA\u5F53\u524D\u8BF7\u6C42\u7528\u6237\u7684\u4EFB\u610F\u7C7B\u578B\u7684\u8BBE\u5907</a></li><li><a href="#_3-3-\u9000\u51FA\u5F53\u524D\u8BF7\u6C42\u7528\u6237\u7684\u4EFB\u610F\u8BBE\u5907\u7C7B\u578B-\u4EFB\u610F\u8BBE\u5907id\u7684\u8BBE\u5907">3.3 \u9000\u51FA\u5F53\u524D\u8BF7\u6C42\u7528\u6237\u7684\u4EFB\u610F\u8BBE\u5907\u7C7B\u578B&amp;\u4EFB\u610F\u8BBE\u5907ID\u7684\u8BBE\u5907</a></li><li><a href="#_3-4-\u9000\u51FA\u5F53\u524D\u8BF7\u6C42\u7528\u6237\u7684\u6240\u6709\u8BBE\u5907">3.4 \u9000\u51FA\u5F53\u524D\u8BF7\u6C42\u7528\u6237\u7684\u6240\u6709\u8BBE\u5907</a></li></ul></li><li><a href="#_4-\u7EDF\u4E00\u7684\u767B\u5F55\u5F02\u5E38\u5904\u7406">4. \u7EDF\u4E00\u7684\u767B\u5F55\u5F02\u5E38\u5904\u7406</a></li><li><a href="#_5-\u767B\u5F55\u8BF7\u6C42\u4EE5\u53CAtoken\u914D\u7F6E\uFF08\u5982\u4F55\u4F7F\u7528\u8FD4\u56DE\u7684token\uFF0Ctoken\u7684\u8FC7\u671F\u65F6\u95F4\uFF09">5. \u767B\u5F55\u8BF7\u6C42\u4EE5\u53CAtoken\u914D\u7F6E\uFF08\u5982\u4F55\u4F7F\u7528\u8FD4\u56DE\u7684token\uFF0Ctoken\u7684\u8FC7\u671F\u65F6\u95F4\uFF09</a><ul><li><a href="#_5-1-\u53CCtoken\u6A21\u5F0F">5.1 \u53CCToken\u6A21\u5F0F</a></li><li><a href="#_5-2-\u5355token\u6A21\u5F0F">5.2 \u5355Token\u6A21\u5F0F</a></li><li><a href="#_5-3-cookie\u643A\u5E26token">5.3 cookie\u643A\u5E26token</a><ul></ul></li></ul></li></ul></nav><h2 id="_1-\u57FA\u672C\u7684\u767B\u5F55\u903B\u8F91" tabindex="-1">1. \u57FA\u672C\u7684\u767B\u5F55\u903B\u8F91 <a class="header-anchor" href="#_1-\u57FA\u672C\u7684\u767B\u5F55\u903B\u8F91" aria-hidden="true">#</a></h2><p>\u5728Authz\u4E2D\uFF0C\u767B\u5F55\u4E0E\u9A8C\u8BC1\u65F6\u5206\u5F00\u7684\uFF0C\u4E5F\u5C31\u662F\u8BF4\u767B\u5F55\u662F<strong>\u975E\u9A8C\u8BC1\u578B</strong>\u7684\uFF0C\u5373<u>\u4E0D\u9700\u8981\u9A8C\u8BC1\u4FBF\u53EF\u4EE5\u76F4\u63A5\u767B\u5F55</u>\uFF0C<strong>\u6240\u4EE5\u5728\u8FD9\u4E4B\u524D\u9700\u8981\u4F60\u8FDB\u884C\u81EA\u5DF1\u7684\u9A8C\u8BC1\u903B\u8F91</strong>\uFF0C\u6765\u5224\u65AD\u8FD9\u4E2A\u7528\u6237\u662F\u5426\u767B\u5F55\u6210\u529F\u3002</p><div class="tip custom-block"><p class="custom-block-title">\u8BF4\u660E</p><p>\u8FD9\u91CC\u7684\u9A8C\u8BC1\u4E0D\u4EC5\u9650\u4E8E\u8D26\u53F7\u5BC6\u7801\uFF0C\u8FD8\u53EF\u4EE5\u662F\u90AE\u7BB1\u3001\u624B\u673A\u77ED\u4FE1\u9A8C\u8BC1\u7B49</p></div><p>\u5728\u767B\u5F55\u4E4B\u524D\uFF0C\u8FD8\u5F97\u5148\u9700\u8981\u77E5\u9053\u4E00\u4E9B\u4E8B\uFF0C</p><p><strong>Authz\u4F1A\u7ED9\u767B\u5F55\u540E\u7684\u7528\u6237\u53D1\u5E03\u7B7E\u540D\u7684token\uFF0C\u6240\u4EE5\u5FC5\u987B\u6709\u4EE5\u4E0B\u914D\u7F6E\uFF0C\u4E5F\u5C31\u662F\u5BC6\u94A5</strong></p><div class="language-yaml"><button class="copy"></button><span class="lang">yaml</span><pre><code><span class="line"><span style="color:#F07178;">authz</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">token</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">key</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"></span></code></pre></div><h2 id="_2-\u767B\u5F55" tabindex="-1">2. \u767B\u5F55 <a class="header-anchor" href="#_2-\u767B\u5F55" aria-hidden="true">#</a></h2><div class="warning custom-block"><p class="custom-block-title">\u6CE8\u610F</p><p>\u82E5\u5F53\u524D\u8BF7\u6C42\u5DF2\u767B\u5F55\uFF0C\u90A3\u4E48\u6B64\u6B21\u8BF7\u6C42\u7528\u6237\u7684\u767B\u5F55\u4FE1\u606F\u4F1A\u5931\u6548\u3002\u76F8\u5F53\u4E8E logout \u518D login\u3002</p><p>\u53EF\u4EE5\u914D\u7F6E\u4E3A\u4E0D\u5931\u6548 ==&gt; <a href="/guide/settings#token\u914D\u7F6E">\u767B\u5F55\u524D\u9000\u51FA - authz.token.logout-before-login</a></p></div><div class="info custom-block"><p class="custom-block-title">API</p><div class="language-java"><button class="copy"></button><span class="lang">java</span><pre><code><span class="line"><span style="color:#89DDFF;">@</span><span style="color:#C792EA;">NonNull</span></span>
<span class="line"><span style="color:#C792EA;">IssueToken</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">login</span><span style="color:#89DDFF;">(@</span><span style="color:#C792EA;">NonNull</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">Object</span><span style="color:#A6ACCD;"> userId </span><span style="color:#89DDFF;">[,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">@</span><span style="color:#C792EA;">NonNull</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">String</span><span style="color:#A6ACCD;"> deviceType</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">@</span><span style="color:#C792EA;">Nullable</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">String</span><span style="color:#A6ACCD;"> deviceId</span><span style="color:#89DDFF;">])</span></span>
<span class="line"></span></code></pre></div><ul><li><p><strong>\u8BF4\u660E</strong></p><blockquote><p>\u7528\u6237\u767B\u5F55 &lt;\u53EF\u7528\u4E8E\u975E\u8BF7\u6C42\u73AF\u8282&gt; \u82E5\u7EBF\u7A0B\u7ED1\u5B9A\u4E86Request\uFF0C\u5219\u767B\u5F55\u6210\u529F\u4E4B\u540E\u4F1A\u9ED8\u8BA4\u7ED9\u8BF7\u6C42\u8FD4\u56DECookie \u8FC7\u671F\u65F6\u95F4\u4E3AAccessToken\u7684\u8FC7\u671F\u65F6\u95F4\uFF0C\u82E5\u4E0D\u9700\u8981\uFF0C\u8BF7\u81EA\u884C\u5220\u9664</p></blockquote></li><li><p><strong>\u53C2\u6570</strong></p><ul><li><u>userId</u> - \u7528\u6237id \u4E0D\u4E3A\u7A7A</li><li><u>deviceType</u> <u>[\u53EF\u9009]</u> - \u8BBE\u5907\u7C7B\u578B \u4E0D\u4E3A\u7A7A \u9ED8\u8BA4\u4E3Auser-agnet\uFF0C\u82E5\u6CA1\u6709\u5219\u4E3Aunknown</li><li><u>deviceId</u> <u>[\u53EF\u9009]</u> - \u8BBE\u5907id \u53EF\u4E3Anull</li></ul></li><li><p><strong>\u8FD4\u56DE</strong></p><ul><li>\u6388\u6743\u540E\u7684IssueToken(accessToken\u4EE5\u53CArefreshToken)\uFF0C\u8FD4\u56DE\u7A7A\u5219\u767B\u5F55\u5931\u8D25</li></ul></li></ul></div><h3 id="_2-1-\u53EA\u7ED9\u5B9Auserid" tabindex="-1">2.1 \u53EA\u7ED9\u5B9AuserId <a class="header-anchor" href="#_2-1-\u53EA\u7ED9\u5B9Auserid" aria-hidden="true">#</a></h3><div class="language-java"><button class="copy"></button><span class="lang">java</span><pre><code><span class="line"><span style="color:#89DDFF;">@</span><span style="color:#C792EA;">Autowired</span></span>
<span class="line"><span style="color:#C792EA;">private</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">UserService</span><span style="color:#A6ACCD;"> userService</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">@</span><span style="color:#C792EA;">PostMapping</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">/login</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">IssueToken</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">login</span><span style="color:#89DDFF;">(@</span><span style="color:#C792EA;">RequestBody</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">User</span><span style="color:#A6ACCD;"> user</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span></span>
<span class="line"><span style="color:#89DDFF;">  	</span><span style="color:#676E95;">// \u9A8C\u8BC1user\u662F\u5426\u5B58\u5728\u4EE5\u53CA\u6709\u6548\uFF0C\u8FD9\u91CC\u7684\u9A8C\u8BC1\u4E0D\u4EC5\u9650\u4E8E\u8D26\u53F7\u5BC6\u7801\uFF0C\u8FD8\u53EF\u4EE5\u662F\u90AE\u7BB1\u3001\u624B\u673A\u77ED\u4FE1\u9A8C\u8BC1\u7B49</span></span>
<span class="line"><span style="color:#89DDFF;">  	</span><span style="color:#676E95;">// \u5982\uFF1A    </span></span>
<span class="line"><span style="color:#89DDFF;">  	</span><span style="color:#676E95;">//    if (&quot;admin&quot;.equals(user.getUsername()) &amp;&amp; &quot;12345&quot;.equals(user.getPassword())) {</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">//          \u767B\u5F55\u6210\u529F</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">//           ...</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">//    }</span></span>
<span class="line"><span style="color:#A6ACCD;">  	</span><span style="color:#C792EA;">int</span><span style="color:#A6ACCD;"> userId </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> userService</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">login</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">user</span><span style="color:#89DDFF;">);</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;">// \u767B\u5F55\u6210\u529F\u8FD4\u56DE\u7528\u6237id\uFF0C\u5426\u5219\u8FD4\u56DE-1</span></span>
<span class="line"><span style="color:#A6ACCD;">  		</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">if</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">userId </span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line highlighted"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">return</span><span style="color:#A6ACCD;"> AuHelper</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">login</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">userId</span><span style="color:#89DDFF;">);</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;">// \u5C06IssueToken\u8FD4\u56DE\uFF0C\u6216\u8005\u7528\u4F60\u7684Result\u5305\u88C5\u4E00\u4E0B</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">else</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">return</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">null;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><h3 id="_2-2-\u7ED1\u5B9A\u8BBE\u5907\u7C7B\u578B\uFF08\u64CD\u4F5C\u7CFB\u7EDF\u3001\u5E73\u53F0\uFF09\u7B49" tabindex="-1">2.2 \u7ED1\u5B9A<u>\u8BBE\u5907\u7C7B\u578B</u>\uFF08\u64CD\u4F5C\u7CFB\u7EDF\u3001\u5E73\u53F0\uFF09\u7B49 <a class="header-anchor" href="#_2-2-\u7ED1\u5B9A\u8BBE\u5907\u7C7B\u578B\uFF08\u64CD\u4F5C\u7CFB\u7EDF\u3001\u5E73\u53F0\uFF09\u7B49" aria-hidden="true">#</a></h3><div class="language-java"><button class="copy"></button><span class="lang">java</span><pre><code><span class="line"><span style="color:#89DDFF;">if</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">userId </span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line highlighted"><span style="color:#A6ACCD;">	</span><span style="color:#89DDFF;">return</span><span style="color:#A6ACCD;"> AuHelper</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">login</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">userId</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Mac</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">);</span></span>
<span class="line highlighted"><span style="color:#89DDFF;">	</span><span style="color:#676E95;">// \u6216\u8005 </span></span>
<span class="line highlighted"><span style="color:#89DDFF;">	</span><span style="color:#676E95;">// AuHelper.login(userId, AuHelper.getPlatform().getName(), null);</span></span>
<span class="line highlighted"><span style="color:#89DDFF;">	</span><span style="color:#676E95;">// AuHelper.getPlatform().getName() &lt;==&gt; \u83B7\u53D6\u5F53\u524D\u8BF7\u6C42\u7684\u5E73\u53F0\u540D\u79F0\uFF0C</span></span>
<span class="line highlighted"><span style="color:#89DDFF;">	</span><span style="color:#676E95;">// \u6709iPhone\u3001iPad\u3001Android\u3001Mac\u3001Windows\u7B49</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">else</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#89DDFF;">return</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">null;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><h3 id="_2-3-\u7ED1\u5B9A\u8BBE\u5907\u7C7B\u578B\u3001\u8BBE\u5907id" tabindex="-1">2.3 \u7ED1\u5B9A<u>\u8BBE\u5907\u7C7B\u578B\u3001\u8BBE\u5907Id</u> <a class="header-anchor" href="#_2-3-\u7ED1\u5B9A\u8BBE\u5907\u7C7B\u578B\u3001\u8BBE\u5907id" aria-hidden="true">#</a></h3><div class="warning custom-block"><p class="custom-block-title">\u6CE8\u610F</p><p>\u8BBE\u5907id\u53EF\u4EE5\u4E3Anull\uFF0C\u8BBE\u5907id\u5728\u540C\u8BBE\u5907\u7C7B\u578B\u4E2D\u662F\u552F\u4E00\u7684\u3002\u540C\u4E00\u8BBE\u5907id\u53EF\u4EE5\u6709\u4E0D\u540C\u7684\u8BBE\u5907\u7C7B\u578B</p><p>\u5982\uFF1A</p><p>Mac\u7AEF\u7684\u8BBE\u5907\u3001\u4E14\u8BBE\u5907id\u4E3AABCD\u7684\u8BBE\u5907</p><p>Mac\u7AEF\u7684\u8BBE\u5907\u3001\u4E14\u8BBE\u5907id\u4E3AEFGH\u7684\u8BBE\u5907</p><p>\u8BBE\u5907id\u4E3AABCD\u7684\u8BBE\u5907\u53EF\u80FD\u5904\u4E8E\u5B89\u5353\u8BBE\u5907\u7C7B\u578B\u4E0B\u4E5F\u53EF\u80FD\u5904\u4E8E\u81EA\u5B9A\u4E49\u7684\u8BBE\u5907\u7C7B\u578B\u5982qq\u3001\u5FAE\u4FE1\u7B49\u3002</p><p>\u6240\u4EE5\u8BBE\u5907id\u5E76\u5168\u5C40\u552F\u4E00\uFF0C\u800C\u662F\u5728\u67D0\u4E00\u8BBE\u5907\u7C7B\u578B\u4E2D\u552F\u4E00\uFF0C\u5728 <a href="/guide/basics/device-control">\u8BBE\u5907\u7BA1\u7406</a> \u91CC\u4F1A\u6709\u7528</p></div><div class="language-java"><button class="copy"></button><span class="lang">java</span><pre><code><span class="line"><span style="color:#89DDFF;">if</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">userId </span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line highlighted"><span style="color:#A6ACCD;">	</span><span style="color:#89DDFF;">return</span><span style="color:#A6ACCD;"> AuHelper</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">login</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">userId</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Mac</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">FFFFFFFF-FFFF-FFFF</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#89DDFF;">	</span><span style="color:#676E95;">// \u6216\u8005 AuHelper.login(userId, AuHelper.getPlatform().getName(), null);</span></span>
<span class="line"><span style="color:#89DDFF;">	</span><span style="color:#676E95;">// \u6216\u8005 AuHelper.login(userId, AuHelper.getOS().getName(), null);</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">else</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#89DDFF;">return</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">null;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><div class="tip custom-block"><p class="custom-block-title">\u8865\u5145</p><p>\u9ED8\u8BA4\u60C5\u51B5\u4E0B AuHelper.login(userId) \u5728\u6CA1\u6709\u6307\u5B9AdeviceType\u65F6\uFF0C\u9ED8\u8BA4\u7684\u503C\u4E3Auser-agent\uFF0C\u5728\u6CA1\u6709\u6307\u5B9AdeviceId\u65F6\uFF0C\u9ED8\u8BA4\u7684\u503C\u4E3Anull</p></div><h2 id="_3-\u767B\u51FA\uFF08\u9000\u51FA\u767B\u5F55\uFF09" tabindex="-1">3. \u767B\u51FA\uFF08\u9000\u51FA\u767B\u5F55\uFF09 <a class="header-anchor" href="#_3-\u767B\u51FA\uFF08\u9000\u51FA\u767B\u5F55\uFF09" aria-hidden="true">#</a></h2><div class="info custom-block"><p class="custom-block-title">API</p><div class="language-java"><button class="copy"></button><span class="lang">java</span><pre><code><span class="line"><span style="color:#C792EA;">void</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">logout</span><span style="color:#89DDFF;">([@</span><span style="color:#C792EA;">NonNull</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">String</span><span style="color:#A6ACCD;"> deviceType</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">@</span><span style="color:#C792EA;">Nullable</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">String</span><span style="color:#A6ACCD;"> deviceId</span><span style="color:#89DDFF;">])</span><span style="color:#A6ACCD;"> throws </span><span style="color:#C792EA;">NotLoginException</span></span>
<span class="line"></span></code></pre></div><ul><li><p><strong>\u8BF4\u660E</strong></p><blockquote><p>\u6CE8\u9500\u5F53\u524D\u7528\u6237\u7684\u5F53\u524D\u8BBE\u5907</p><p>\u3010deviceType\u3011\u6CE8\u9500\u5F53\u524D\u7528\u6237\u6307\u5B9A<strong>\u8BBE\u5907\u7C7B\u578B</strong>\u8BBE\u5907</p><p>\u3010deviceType\uFF0CdeviceId\u3011\u6CE8\u9500\u5F53\u524D\u7528\u6307\u5B9A\u6237<strong>\u8BBE\u5907\u7C7B\u578B\u3001\u8BBE\u5907id</strong>\u7684\u8BBE\u5907</p></blockquote></li><li><p><strong>\u53C2\u6570</strong></p><ul><li><u>deviceType</u> <u>[\u53EF\u9009]</u> - \u9000\u51FA\u8BBE\u5907\u7684\u7C7B\u578B</li><li><u>deviceId</u> <u>[\u53EF\u9009]</u> - \u9000\u51FA\u8BBE\u5907\u7684id</li></ul></li><li><p><strong>\u5F02\u5E38</strong></p><ul><li>NotLoginException \u672A\u767B\u5F55\u8C03\u7528\u6B64\u65B9\u6CD5\u629B\u51FA\u5F02\u5E38</li></ul></li></ul></div><h3 id="_3-1-\u9000\u51FA\u5F53\u524D\u8BF7\u6C42\u7528\u6237" tabindex="-1">3.1 \u9000\u51FA<u>\u5F53\u524D\u8BF7\u6C42\u7528\u6237</u> <a class="header-anchor" href="#_3-1-\u9000\u51FA\u5F53\u524D\u8BF7\u6C42\u7528\u6237" aria-hidden="true">#</a></h3><div class="language-java"><button class="copy"></button><span class="lang">java</span><pre><code><span class="line highlighted"><span style="color:#89DDFF;">@</span><span style="color:#C792EA;">AuthRequireLogin</span></span>
<span class="line"><span style="color:#89DDFF;">@</span><span style="color:#C792EA;">GetMapping</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">/logout</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">String</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">logout</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line highlighted"><span style="color:#A6ACCD;">    AuHelper</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">logout</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">return</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">ok</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><h3 id="_3-2-\u9000\u51FA\u5F53\u524D\u8BF7\u6C42\u7528\u6237\u7684\u4EFB\u610F\u7C7B\u578B\u7684\u8BBE\u5907" tabindex="-1">3.2 \u9000\u51FA<u>\u5F53\u524D\u8BF7\u6C42\u7528\u6237</u>\u7684<u>\u4EFB\u610F\u7C7B\u578B\u7684\u8BBE\u5907</u> <a class="header-anchor" href="#_3-2-\u9000\u51FA\u5F53\u524D\u8BF7\u6C42\u7528\u6237\u7684\u4EFB\u610F\u7C7B\u578B\u7684\u8BBE\u5907" aria-hidden="true">#</a></h3><div class="language-java"><button class="copy"></button><span class="lang">java</span><pre><code><span class="line highlighted"><span style="color:#89DDFF;">@</span><span style="color:#C792EA;">AuthRequireLogin</span></span>
<span class="line"><span style="color:#89DDFF;">@</span><span style="color:#C792EA;">GetMapping</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">/logout</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">String</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">logout</span><span style="color:#89DDFF;">(@</span><span style="color:#C792EA;">RequestParam</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">String</span><span style="color:#A6ACCD;"> deviceType</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line highlighted"><span style="color:#A6ACCD;">    AuHelper</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">logout</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">deviceType</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">return</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">ok</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><h3 id="_3-3-\u9000\u51FA\u5F53\u524D\u8BF7\u6C42\u7528\u6237\u7684\u4EFB\u610F\u8BBE\u5907\u7C7B\u578B-\u4EFB\u610F\u8BBE\u5907id\u7684\u8BBE\u5907" tabindex="-1">3.3 \u9000\u51FA<u>\u5F53\u524D\u8BF7\u6C42\u7528\u6237</u>\u7684<u>\u4EFB\u610F\u8BBE\u5907\u7C7B\u578B&amp;\u4EFB\u610F\u8BBE\u5907ID\u7684\u8BBE\u5907</u> <a class="header-anchor" href="#_3-3-\u9000\u51FA\u5F53\u524D\u8BF7\u6C42\u7528\u6237\u7684\u4EFB\u610F\u8BBE\u5907\u7C7B\u578B-\u4EFB\u610F\u8BBE\u5907id\u7684\u8BBE\u5907" aria-hidden="true">#</a></h3><div class="language-java"><button class="copy"></button><span class="lang">java</span><pre><code><span class="line highlighted"><span style="color:#89DDFF;">@</span><span style="color:#C792EA;">AuthRequireLogin</span></span>
<span class="line"><span style="color:#89DDFF;">@</span><span style="color:#C792EA;">GetMapping</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">/logout</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">String</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">logout</span><span style="color:#89DDFF;">(@</span><span style="color:#C792EA;">RequestParam</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">String</span><span style="color:#A6ACCD;"> deviceType</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">@</span><span style="color:#C792EA;">RequestParam</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">String</span><span style="color:#A6ACCD;"> deviceId</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line highlighted"><span style="color:#A6ACCD;">    AuHelper</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">logout</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">deviceType</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> deviceId</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">return</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">ok</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><hr><div class="info custom-block"><p class="custom-block-title">API</p><div class="language-java"><button class="copy"></button><span class="lang">java</span><pre><code><span class="line"><span style="color:#C792EA;">void</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">logoutAll</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> throws </span><span style="color:#C792EA;">NotLoginException</span></span>
<span class="line"></span></code></pre></div><ul><li><p><strong>\u8BF4\u660E</strong></p><blockquote><p>\u6CE8\u9500\u5F53\u524D\u7528\u6237\u6240\u6709\u8BBE\u5907</p></blockquote></li><li><p><strong>\u5F02\u5E38</strong></p><ul><li><u>NotLoginException</u> \u672A\u767B\u5F55\u629B\u51FA\u5F02\u5E38</li></ul></li></ul></div><h3 id="_3-4-\u9000\u51FA\u5F53\u524D\u8BF7\u6C42\u7528\u6237\u7684\u6240\u6709\u8BBE\u5907" tabindex="-1">3.4 \u9000\u51FA<u>\u5F53\u524D\u8BF7\u6C42\u7528\u6237</u>\u7684<u>\u6240\u6709\u8BBE\u5907</u> <a class="header-anchor" href="#_3-4-\u9000\u51FA\u5F53\u524D\u8BF7\u6C42\u7528\u6237\u7684\u6240\u6709\u8BBE\u5907" aria-hidden="true">#</a></h3><div class="language-java"><button class="copy"></button><span class="lang">java</span><pre><code><span class="line highlighted"><span style="color:#89DDFF;">@</span><span style="color:#C792EA;">AuthRequireLogin</span></span>
<span class="line"><span style="color:#89DDFF;">@</span><span style="color:#C792EA;">GetMapping</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">/logout-all</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">String</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">logout</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line highlighted"><span style="color:#A6ACCD;">    AuHelper</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">logoutAll</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">return</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">ok</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><h2 id="_4-\u7EDF\u4E00\u7684\u767B\u5F55\u5F02\u5E38\u5904\u7406" tabindex="-1">4. \u7EDF\u4E00\u7684\u767B\u5F55\u5F02\u5E38\u5904\u7406 <a class="header-anchor" href="#_4-\u7EDF\u4E00\u7684\u767B\u5F55\u5F02\u5E38\u5904\u7406" aria-hidden="true">#</a></h2><p>\u76F4\u63A5\u8C03\u7528\u9700\u8981\u767B\u5F55\u7684\u64CD\u4F5C\u65F6\uFF0C\u5F53\u524D\u7EBF\u7A0B\uFF08\u8BF7\u6C42\u7EBF\u7A0B\uFF09\u5982\u679C\u672A\u767B\u5F55\uFF0C\u90A3\u4E48\u5C06\u4F1A\u629B\u51FA\u767B\u5F55\u5F02\u5E38\uFF0C\u5982\u679C\u4E0D\u60F3\u5904\u7406\u8FD9\u4E2A\u5F02\u5E38\uFF0C\u53EF\u4EE5\u8FDB\u884C<strong>\u5168\u5C40\u5F02\u5E38\u62E6\u622A</strong>\uFF0C\u4F8B\u5982\uFF1A</p><div class="language-java"><button class="copy"></button><span class="lang">java</span><pre><code><span class="line"><span style="color:#89DDFF;">@</span><span style="color:#C792EA;">ControllerAdvice</span></span>
<span class="line"><span style="color:#89DDFF;">@</span><span style="color:#C792EA;">ResponseBody</span></span>
<span class="line"><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">class</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">WebExceptionHandler</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"></span>
<span class="line highlighted"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">@</span><span style="color:#C792EA;">ExceptionHandler</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">NotLoginException</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">class</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">Result</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">notLoginException</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">return</span><span style="color:#A6ACCD;"> Result</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">FAIL</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">data</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><h2 id="_5-\u767B\u5F55\u8BF7\u6C42\u4EE5\u53CAtoken\u914D\u7F6E\uFF08\u5982\u4F55\u4F7F\u7528\u8FD4\u56DE\u7684token\uFF0Ctoken\u7684\u8FC7\u671F\u65F6\u95F4\uFF09" tabindex="-1">5. \u767B\u5F55\u8BF7\u6C42\u4EE5\u53CAtoken\u914D\u7F6E\uFF08\u5982\u4F55\u4F7F\u7528\u8FD4\u56DE\u7684token\uFF0Ctoken\u7684\u8FC7\u671F\u65F6\u95F4\uFF09 <a class="header-anchor" href="#_5-\u767B\u5F55\u8BF7\u6C42\u4EE5\u53CAtoken\u914D\u7F6E\uFF08\u5982\u4F55\u4F7F\u7528\u8FD4\u56DE\u7684token\uFF0Ctoken\u7684\u8FC7\u671F\u65F6\u95F4\uFF09" aria-hidden="true">#</a></h2><p>\u5728\u524D\u9762login\u83B7\u5F97\u7684token\u7684\u683C\u5F0F\u5E94\u8BE5\u5982\u4E0B</p><div class="language-json"><button class="copy"></button><span class="lang">json</span><pre><code><span class="line"><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C792EA;">accessToken</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">H4sIAAAAAAAAAKtWKs1MUbIy1FEqAdFKxRVRfqFRXhVKOkopJQVAgYD84pLcxLyg0rySzNxUfXM9I0s9I6BsVkkmUNY3LNCr3K84ECiQWgFUbmhmZmBuYGxpaVoLAKNv5ldaAAAA.jLaYmxgRYevoZOBg3wp5dzsGF4cLX28jGEhVas6qpMM</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C792EA;">refreshToken</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">H4sIAAAAAAAAAKtWKs1MUbIy1FHKKslUslIqrojyC43yqlDSUUqtKABKmJkZmVkaGlqa1gIAHoBGNSsAAAA.kbnom6IDbj7W5I1zvQO_s5oZC532YlyugDJibBFQoGc</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C792EA;">expiresIn</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">604800000</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p><a href="/guide/settings#token\u914D\u7F6E">\u67E5\u770B\u5177\u4F53\u914D\u7F6E</a></p><h3 id="_5-1-\u53CCtoken\u6A21\u5F0F" tabindex="-1">5.1 \u53CCToken\u6A21\u5F0F <a class="header-anchor" href="#_5-1-\u53CCtoken\u6A21\u5F0F" aria-hidden="true">#</a></h3><p>\u8FD9\u79CD\u6A21\u5F0F\u7C7B\u4F3C\u4E8EOpenAuth2.0\u7684\u6A21\u5F0F\uFF0C\u9ED8\u8BA4\u60C5\u51B5\u4E0B\u4F1A\u751F\u6210\u4E24\u4E2Atoken\uFF0C\u4E00\u4E2A\u4E3A<strong>accessToken</strong>\uFF0C\u7528\u6765\u6B63\u5E38\u8BBF\u95EE\u7CFB\u7EDF\u3002\u4E00\u4E2A\u4E3A<strong>refreshToken</strong>\u7528\u6765\u5237\u65B0accessToken\u83B7\u5F97\u65B0\u7684accessToken\u548CrefreshToken\u3002\u4F46\u662F\u6CA1\u6709scope\u7684\u6982\u5FF5</p><p>\u4E24\u4E2Atoken\u7684\u8FC7\u671F\u65F6\u95F4\u53EF\u4EE5\u5982\u4E0B\u63A7\u5236</p><div class="language-yaml"><button class="copy"></button><span class="lang">yaml</span><pre><code><span class="line"><span style="color:#F07178;">authz</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">token</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">key</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line highlighted"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">access-time</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">1d</span></span>
<span class="line highlighted"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">refresh-time</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">30d</span></span>
<span class="line"></span></code></pre></div><p><strong>expiresIn</strong>\u4E3AaccessToken\u7684\u8FC7\u671F\u65F6\u95F4\uFF0C\u5728\u5FEB\u8FC7\u671F\u65F6\uFF0C\u7406\u5E94\u7528refreshToken\u53BB\u5237\u65B0\uFF0C\u4ECE\u800C\u5F97\u5230\u65B0\u7684accessToken\u3002</p><div class="info custom-block"><p class="custom-block-title">API</p><div class="language-java"><button class="copy"></button><span class="lang">java</span><pre><code><span class="line"><span style="color:#C792EA;">IssueToken</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">refreshToken</span><span style="color:#89DDFF;">(@</span><span style="color:#C792EA;">NonNull</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">String</span><span style="color:#A6ACCD;"> refreshToken</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> throws RefreshTokenExpiredException</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">TokenException</span></span>
<span class="line"></span></code></pre></div><p>\u5237\u65B0token\u7684\u63A5\u53E3\uFF0C\u53EF\u4EE5\u7528accessToken\u6765\u83B7\u5F97\u65B0\u7684accessToken\u548CrefreshToken</p></div><p>\u6CE8\u610F\u6B64refreshToken\u5237\u65B0\u540E\u5C06\u5931\u6548\uFF0C\u4E5F\u5C31\u662F\u8BF4\u5B83\u662F\u4E00\u6B21\u6027\u7684\uFF0C\u5237\u65B0\u540E\u8FD8\u662F\u4F1A\u83B7\u5F97\u5982\u4E0A\u683C\u5F0F\u7684\u7ED3\u679C\uFF0C\u4E24\u4E2Atoken\u548C\u4E00\u4E2AaccessToken\u8FC7\u671F\u65F6\u95F4\u3002\u5176\u4E2D<strong>expiresIn\u4E0D\u4F1A\u6539\u53D8(\u83B7\u5F97\u7684\u65B0accessToken\u8FD8\u662F1\u5929\u8FC7\u671F)</strong>\uFF0C<strong>\u4E14\u5E76\u4E0D\u4F1A\u5EF6\u957FrefreshToken\u7684\u65F6\u95F4</strong></p><div class="language-json"><button class="copy"></button><span class="lang">json</span><pre><code><span class="line"><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C792EA;">accessToken</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">...</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C792EA;">refreshToken</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">...</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C792EA;">expiresIn</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">86400000</span><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><h3 id="_5-2-\u5355token\u6A21\u5F0F" tabindex="-1">5.2 \u5355Token\u6A21\u5F0F <a class="header-anchor" href="#_5-2-\u5355token\u6A21\u5F0F" aria-hidden="true">#</a></h3><p>\u5982\u679C\u4E0D\u9700\u8981\u5237\u65B0accessToken\uFF0C\u4E5F\u5C31\u662F\u53EA\u9700\u8981\u7528\u4E00\u4E2Atoken\u5C31\u591F\u4E86\uFF0C\u90A3\u4E48\u53EF\u4EE5\u628AaccessToken\u7684\u65F6\u95F4\u548CrefreshToken\u7684\u6709\u6548\u65F6\u95F4\u8BBE\u7F6E\u4E3A\u4E00\u6837\u5373\u53EF\u3002</p><div class="language-yaml"><button class="copy"></button><span class="lang">yaml</span><pre><code><span class="line"><span style="color:#F07178;">authz</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">token</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">key</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line highlighted"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">access-time</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">30d</span></span>
<span class="line highlighted"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">refresh-time</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">30d</span></span>
<span class="line"></span></code></pre></div><h3 id="_5-3-cookie\u643A\u5E26token" tabindex="-1">5.3 cookie\u643A\u5E26token <a class="header-anchor" href="#_5-3-cookie\u643A\u5E26token" aria-hidden="true">#</a></h3><p>\u8FD9\u662F\u9ED8\u8BA4\u60C5\u51B5\u4E0B\u7684\u5B9E\u73B0\uFF0C\u4E14\u76F8\u5173\u7684cookie\u540D\u4E3A<code>atkn</code> \uFF08authz token\uFF09\uFF0C\u53EF\u4EE5\u4FEE\u6539\uFF0C\u4E14\u4E0D\u9700\u8981\u505A\u4EFB\u4F55\u64CD\u4F5C\uFF0C\u53EA\u9700\u8981\u5728\u524D\u7AEF\u652F\u6301cookie\uFF0C\u4E14\u8BF7\u6C42\u65F6\u643A\u5E26cookie\u5373\u53EF</p><p>\u4E5F\u53EF\u4EE5\u4FEE\u6539cookie\u7684\u540D\u5B57\u3002</p><div class="language-yaml"><button class="copy"></button><span class="lang">yaml</span><pre><code><span class="line"><span style="color:#F07178;">authz</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">token</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">key</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line highlighted"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">cookie-name</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">your cookie name</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"></span></code></pre></div><h4 id="_5-4-header\u643A\u5E26token" tabindex="-1">5.4 Header\u643A\u5E26token <a class="header-anchor" href="#_5-4-header\u643A\u5E26token" aria-hidden="true">#</a></h4><p>\u9ED8\u8BA4\u60C5\u51B5\u4F1A\u4ECEheader\u4E2D\u7684<code>authorization</code>\u8BFB\u53D6token\u4E14\u524D\u7F00\u4E3A<code>Bearer</code></p><p>\u4E5F\u5C31\u662F\u8BF4\u5934\u4FE1\u606F\u5FC5\u987B\u5982\u4E0B\uFF0C\u6CE8\u610F<code>Bearer</code>\u4E4B\u540E\u8BB0\u5F97\u7A7A\u4E00\u683C</p><div class="language-"><button class="copy"></button><span class="lang"></span><pre><code><span class="line"><span style="color:#A6ACCD;">Authorization: Bearer H4sIAAAAAAAAAKtWKs1MUbIy1FEqAdFKxRVRfqFRXhVKOkopJQVAgYD84pLcxLyg0rySzNxUfXM9I0s9I6BsVkkmUNY3LNCr3K84ECiQWgFUbmhmZmBuYGxpaVoLAKNv5ldaAAAA.jLaYmxgRYevoZOBg3wp5dzsGF4cLX28jGEhVas6qpMM</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>\u5F53\u7136\u8FD9\u4E2A\u540D\u5B57\u548C\u524D\u7F00\u4E5F\u53EF\u4EE5\u4FEE\u6539</p><div class="language-yaml"><button class="copy"></button><span class="lang">yaml</span><pre><code><span class="line"><span style="color:#F07178;">authz</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">token</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">key</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line highlighted"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">header-name</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">your header name</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line highlighted"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">header-prefix</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">your header prefix</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"></span></code></pre></div><h4 id="_5-5-authrequesttoken\u3001\u53C2\u6570\u643A\u5E26token" tabindex="-1">5.5 AuthRequestToken\u3001\u53C2\u6570\u643A\u5E26token <a class="header-anchor" href="#_5-5-authrequesttoken\u3001\u53C2\u6570\u643A\u5E26token" aria-hidden="true">#</a></h4><p>\u5229\u7528<code>AuthRequestToken</code>\u53EF\u4EE5\u5B9E\u73B0\u53C2\u6570\u643A\u5E26token\uFF0C\u540C\u65F6\u4E5F\u652F\u6301\u4E0A\u9762\u4E24\u79CD</p><p>\u5728\u8BF7\u6C42\u65F6\uFF0C\u5728\u540E\u9762\u5E26\u4E0A\u53C2\u6570</p><p>\u5982 <code>~/admin/check?\u53C2\u6570\u540D={\u62FF\u5230\u7684accessToken}</code></p><div class="language-java"><button class="copy"></button><span class="lang">java</span><pre><code><span class="line"><span style="color:#89DDFF;">@</span><span style="color:#C792EA;">RestController</span></span>
<span class="line"><span style="color:#89DDFF;">@</span><span style="color:#C792EA;">RequestMapping</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">/admin</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">)</span></span>
<span class="line highlighted"><span style="color:#89DDFF;">@</span><span style="color:#C792EA;">AuthRequestToken</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">\u53C2\u6570\u540D</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;">// &lt;==&gt; @AuthRequestToken(param = &quot;\u53C2\u6570\u540D&quot;)</span></span>
<span class="line"><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">class</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">OAuthController2</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;"> </span></span>
<span class="line"></span>
<span class="line highlighted"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">@</span><span style="color:#C792EA;">AuthRequireLogin</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">@</span><span style="color:#C792EA;">GetMapping</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">/check</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">String</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">check</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">return</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">ok</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div>`,64),e=[o];function t(c,r,D,y,F,i){return n(),a("div",null,e)}const u=s(p,[["render",t]]);export{C as __pageData,u as default};
